var app = getApp();
//获取全局配置
var common = require('../../../../common.js');

Page({

  /**
   * 页面的初始数据 '约项目',
   */
  data: {
    bill:{},
    detail:{},
    //图片地址前缀
    showImgUrl: common.config.showImgUrl,
    //无会员卡图片的默认会员卡图
    datePicurl: 'https://iservice.daqisoft.cn/Public/Home/images/date.png',
    hisPicurl: 'https://iservice.daqisoft.cn/Public/Home/images/hisdefpic.png',
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    var that = this
    wx.showLoading({
      title: '加载中...',
    })
    var bill = wx.getStorageSync("hdbill")
    var choosecard = wx.getStorageSync("choosecard")
    let func = bill.PayNo ?'Link_GetMMCardConsumeHisInfoPayDetail':'Link_GetMMCardConsumeHisInfoNewChgDetail'
    wx.request({
      url: common.config.host + '/index.php/Api/AutoBase/getHistoryDataDetail',
      data: {
        "authorizerId": app.globalData.authorizerId,
        "openid": wx.getStorageSync("openid"),
        'func':func,
        "shopno": choosecard.ShopNo,
        "cardno": bill.RecNo,
      },
      method: 'POST',
      header: {
        'content-type': 'application/json'
      },
      success: function (res) {
        that.setData({detail:res.data.info})
      },
      fail: function (res) {
        
      }
    })

    this.setData({
      bill:bill,
      choosecard: choosecard
    })
    wx.hideLoading()
  },

  onUnload:function(){
    wx.removeStorageSync("hdbill")
    wx.removeStorageSync("hddetail")
  }


  
})