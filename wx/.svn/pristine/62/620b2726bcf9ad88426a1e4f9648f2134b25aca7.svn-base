<view class="top-type">
  <view class="main-type">
    <view class="flex-wrp">
      <view class="main-item {{tIdx == 1 || !tIdx ? 'active' : ''}}" bindtap="orderTypeTitleChange" data-idx="1">全部订单
        <view class="line"></view>
      </view>
      <view class="main-item {{tIdx == 2 ? 'active' : ''}}" bindtap="orderTypeTitleChange" data-idx="2">{{tname}}
        <view class="line"></view>
      </view>
    </view>
    <view class="type-order clear" style="{{typeOrderDisplay}}">
      <view class="type-item" wx:for="{{orderType}}" bindtap="orderTypeChange" data-tname="{{item.name}}" data-type="{{item.type}}">{{item.name}}</view>
    </view>
  </view>
  <!-- <view class="small-type">
    <view class="flex-wrp">

      <view class="small-item {{!sIdx && index == 0 ? 'active' : index == sIdx ? 'active' : ''}}" wx:for="{{orderState}}" bindtap="orderStateChange" data-idx="{{index}}">{{item}}
        <view class="line"></view>
      </view>

    </view>
  </view> -->
</view>

<view class="orders-con">
  <block wx:for="{{orderData}}">
    <!-- 办卡订单 -->
    <block wx:if="{{item.taskid == 1 || item.taskid == 2}}">
      <view class="order-item">
        <view class="flex-wrp" catchtap="docardOrderdetail" data-guid="{{item.rguid}}">
          <image src="{{item.picurl ? showImgUrl + item.picurl : cardPicUrl}}" lazy-load class="order-pic" mode="aspectFill"></image>
          <view class="order-info">
            <view class="name">{{item.mysqldocardinfo.membershiptypename}}</view>
            <block wx:if="{{item.taskid == 1}}">
              <view class="type-name order-infos-stitle">在线办卡</view>
              <view class="type-name">办卡时间：{{item.tasktime}}</view>
            </block>
            <block wx:elif="{{item.taskid == 2}}">
              <view class="type-name order-infos-stitle">在线充值</view>
              <view class="type-name">充值时间：{{item.tasktime}}</view>
            </block>
            <view class="type-name">办卡门店：{{item.mysqldocardinfo.store_name}}</view>
          </view>

          <view class="order-right">

            <block wx:if="{{item.taskstate == 1}}">
              <view class="state-tips">受理中</view>
            </block>
            <block wx:elif="{{item.taskstate == 2}}">
              <view class="schedule">办理成功</view>
            </block>
            <block wx:elif="{{item.taskstate == 3}}">
              <view class="state-error">办理失败</view>
            </block>

            <block wx:if="{{item.taskstate == 3 && item.mysqldocardinfo.refund_status != ''}}">
              <block wx:if="{{item.mysqldocardinfo.refund_status == 'SUCCESS'}}">
                <view class="schedule" style="margin-top:10rpx">退款成功</view>
              </block>
              <block wx:elif="{{item.mysqldocardinfo.refund_status == 'REFUNDCLOSE'}}">
                <view class="state-tips" style="margin-top:10rpx">退款关闭</view>
              </block>
              <block wx:elif="{{item.mysqldocardinfo.refund_status == 'PROCESSING'}}">
                <view class="state-tips" style="margin-top:10rpx">退款处理中</view>
              </block>
              <block wx:elif="{{item.mysqldocardinfo.refund_status == 'CHANGE'}}">
                <view class="state-tips" style="margin-top:10rpx">退款异常</view>
              </block>
            </block>

          </view>
        </view>

        <block wx:if="{{item.taskstate != 1}}">
          <view class="order-oper">
            <block wx:if="{{item.taskstate == 2 || item.mysqldocardinfo.refund_status == 'SUCCESS'}}">
              <view class="del-order" data-guid="{{item.rguid}}" bindtap="delOrder">删除</view>
            </block>
            <block wx:if="{{item.taskstate == 3 && item.mysqldocardinfo.refund_status == ''}}">
              <view class="again-reserve" data-guid="{{item.rguid}}" bindtap="docardRefund" data-taskid="{{item.taskid}}">退款</view>
            </block>
          </view>
        </block>

      </view>
    </block>

    <!-- 会员卡转赠订单 -->
    <block wx:if="{{item.taskid == 4 && item.srctype}}">
      <view class="order-item">
        <view class="flex-wrp" catchtap="docardOrderdetail" data-guid="{{item.rguid}}">
          <image src="{{item.picurl ? showImgUrl + item.picurl : cardPicUrl}}" lazy-load class="order-pic"></image>
          <view class="order-info">
            <view class="name">{{item.membershiptypename}}</view>
            <view class="type-name order-infos-stitle">会员卡转赠</view>
            <view class="type-name">会员卡号：{{item.cardno}}</view>
            <view class="type-name">转赠时间：{{item.tasktime}}</view>
          </view>

          <view class="order-right">
            <block wx:if="{{item.taskstate == 1}}">
              <view class="state-tips">接收中</view>
            </block>
            <block wx:elif="{{item.taskstate == 2}}">
              <view class="state-tips">会员卡被退回</view>
            </block>
            <block wx:elif="{{item.taskstate == 3}}">
              <view class="state-tips">超时未领取被退回</view>
            </block>
            <!-- <view class="consum-btn btn-gradient" catchtap="lijixiaofei">立即消费</view> -->
          </view>
        </view>
        
        <block wx:if="{{item.taskstate != 1}}">
          <view class="order-oper">
              <view class="del-order" data-guid="{{item.rguid}}" bindtap="delOrder">删除</view>
          </view>
        </block>
      </view>
    </block>

    <!-- 会员卡转赠订单 -->
    <block wx:if="{{item.taskid == 4 && !item.srctype}}">
      <view class="order-item">
        <view class="flex-wrp" catchtap="docardOrderdetail" data-guid="{{item.rguid}}">
          <image src="{{item.picurl ? showImgUrl + item.picurl : cardPicUrl}}" lazy-load class="order-pic"></image>
          <view class="order-info">
            <view class="name">{{item.membershiptypename}}</view>
            <view class="type-name order-infos-stitle">会员卡转赠</view>
            <view class="type-name">会员卡号：{{item.cardno}}</view>
            <view class="type-name">转赠时间：{{item.tasktime}}</view>
          </view>

          <view class="order-right">
            <block wx:if="{{item.taskstate == 1}}">
              <view class="state-tips">已接收，处理中</view>
            </block>
            <block wx:elif="{{item.taskstate == 2}}">
              <view class="schedule">接收成功</view>
            </block>
            <block wx:elif="{{item.taskstate == 3}}">
              <view class="state-error">处理失败</view>
            </block>
            <!-- <view class="consum-btn btn-gradient" catchtap="lijixiaofei">立即消费</view> -->
          </view>
        </view>
        
        <block wx:if="{{item.taskstate != 1}}">
          <view class="order-oper">
              <view class="del-order" data-guid="{{item.rguid}}" bindtap="delOrder">删除</view>
          </view>
        </block>
      </view>
    </block>
  <!-- 预约订单 -->
    <block wx:elif="{{item.taskid == 5}}">
      <view class="order-item">
          <view class="flex-wrp" catchtap="toOrderDetail" data-index="{{index}}" data-guid="{{item.rguid}}" data-taskid="{{item.taskid}}" >
            <image src="{{item.picurl ? showImgUrl + item.picurl : cardPicUrl}}" lazy-load class="order-pic"></image>
            <view class="order-info">
              <view class="name">预约</view>
              <view class="type-name">下单时间：{{item.tasktime}}</view> 
              <view class="type-name">门店：{{item.taskjson.StoreName}}</view>
              <view class="type-name">技师：{{item.taskjson.TechNo}}</view>
            </view>

            <view class="order-right">
               <view class="state-tips">{{item.taskstate==1?"已提交":item.taskresult}}</view>
            </view>
          </view>
        
          <view class="order-oper">
           <view class="del-order" wx:if="{{item.state!=1}}" data-guid="{{item.rguid}}" bindtap="delOrder">删除</view>
          <view class="again-reserve"> 
            <navigator url='../../../../pages/technician/pages/techindex/techindex'>再次预约
            </navigator>
          </view>
          </view>
        </view>
    </block>


  </block>

   <!-- <view class="order-item">
    <view class="flex-wrp" catchtap="toOrderDetail">
      <image src="http://nwx.daqisoft.cn/uploads/j/jmprxe1453369563/2/3/b/6/thumb_59f7ee1141ddc.jpg" lazy-load class="order-pic"></image>
      <view class="order-info">
        <view class="name">60分钟飘然若仙</view>
        <view class="type-name">技师：102号</view>
        <view class="type-name">预约到店时间：02-05 17:00</view>
        <view class="type-name">门店：和毅足道滨江店</view>
      </view>

      <view class="order-right">
        <view class="state-tips">待消费</view>
        <view class="consum-btn btn-gradient" catchtap="lijixiaofei">立即消费</view>
      </view>
    </view>

    <view class="total-price">合计：￥280.00</view>
  </view>  -->

   

</view>

<view class="mask" style="{{!qrDisplay ? 'display:none' : qrDisplay}}"></view>

<view class="qrcode-box animatedSelf zoomIn" style="{{!qrDisplay ? 'display:none' : qrDisplay}}">
  <view class="qrcode-title">
    <view>中医足浴</view>
    <view>￥20.00</view>
    <view class="close-qrcode" bindtap="closeQrcode">×</view>
  </view>
  <view class="qrcodes">
    <view class="qr-t">请出示二维码或券码</view>
    <image src="https://iservice.daqisoft.cn/Public/Home/images/coupon.png" mode="aspectFit"></image>
    <text class="coupon-num" space="nbsp" decode>2011 5210 2352</text>
  </view>
</view>